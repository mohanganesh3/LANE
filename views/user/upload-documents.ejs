<%- include('../partials/header') %>

<div class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-primary rounded-full mb-4">
                <i class="fas fa-file-upload text-3xl text-white"></i>
            </div>
            <h1 class="text-4xl font-bold text-gray-900 mb-2">Upload Verification Documents</h1>
            <p class="text-lg text-gray-600">Upload your documents to get verified and start offering rides</p>
        </div>

        <!-- Progress Steps -->
        <div class="mb-8">
            <div class="flex items-center justify-center space-x-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white font-bold">
                        <i class="fas fa-check"></i>
                    </div>
                    <span class="ml-2 text-sm font-medium text-gray-700">Account Created</span>
                </div>
                <div class="w-16 h-1 bg-primary"></div>
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white font-bold">
                        <i class="fas fa-check"></i>
                    </div>
                    <span class="ml-2 text-sm font-medium text-gray-700">Vehicle Details</span>
                </div>
                <div class="w-16 h-1 bg-primary"></div>
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white font-bold">
                        3
                    </div>
                    <span class="ml-2 text-sm font-medium text-gray-700">Documents</span>
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <form id="uploadForm" action="/user/documents" method="POST" enctype="multipart/form-data">
                
                <!-- Driver's License -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-id-card text-primary mr-3"></i>
                        Driver's License
                        <span class="ml-2 text-sm text-red-500">*Required</span>
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">Upload a clear photo of your driver's license (front side)</p>
                    
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary transition-colors">
                        <input type="file" name="driverLicense" id="driverLicense" accept="image/*,.pdf" required
                               class="hidden" onchange="handleFileSelect(this, 'driverLicensePreview')">
                        <label for="driverLicense" class="cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600">Click to upload or drag and drop</p>
                            <p class="text-sm text-gray-500">PNG, JPG, PDF up to 5MB</p>
                        </label>
                        <div id="driverLicensePreview" class="mt-4 hidden">
                            <img src="" alt="Preview" class="max-w-xs mx-auto rounded-lg shadow-md">
                            <p class="text-sm text-gray-600 mt-2"></p>
                        </div>
                    </div>
                </div>

                <!-- Aadhar Card -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-id-card-alt text-primary mr-3"></i>
                        Aadhar Card
                        <span class="ml-2 text-sm text-red-500">*Required</span>
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">Upload a clear photo of your Aadhar card</p>
                    
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary transition-colors">
                        <input type="file" name="aadharCard" id="aadharCard" accept="image/*,.pdf" required
                               class="hidden" onchange="handleFileSelect(this, 'aadharPreview')">
                        <label for="aadharCard" class="cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600">Click to upload or drag and drop</p>
                            <p class="text-sm text-gray-500">PNG, JPG, PDF up to 5MB</p>
                        </label>
                        <div id="aadharPreview" class="mt-4 hidden">
                            <img src="" alt="Preview" class="max-w-xs mx-auto rounded-lg shadow-md">
                            <p class="text-sm text-gray-600 mt-2"></p>
                        </div>
                    </div>
                </div>

                <!-- Vehicle RC (Registration Certificate) -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-file-alt text-primary mr-3"></i>
                        Vehicle RC (Registration Certificate)
                        <span class="ml-2 text-sm text-red-500">*Required</span>
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">Upload your vehicle registration certificate</p>
                    
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary transition-colors">
                        <input type="file" name="rcBook" id="rcBook" accept="image/*,.pdf" required
                               class="hidden" onchange="handleFileSelect(this, 'rcPreview')">
                        <label for="rcBook" class="cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600">Click to upload or drag and drop</p>
                            <p class="text-sm text-gray-500">PNG, JPG, PDF up to 5MB</p>
                        </label>
                        <div id="rcPreview" class="mt-4 hidden">
                            <img src="" alt="Preview" class="max-w-xs mx-auto rounded-lg shadow-md">
                            <p class="text-sm text-gray-600 mt-2"></p>
                        </div>
                    </div>
                </div>

                <!-- Vehicle Insurance -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-shield-alt text-primary mr-3"></i>
                        Vehicle Insurance
                        <span class="ml-2 text-sm text-red-500">*Required</span>
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">Upload your valid vehicle insurance document</p>
                    
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-primary transition-colors">
                        <input type="file" name="insurance" id="insurance" accept="image/*,.pdf" required
                               class="hidden" onchange="handleFileSelect(this, 'insurancePreview')">
                        <label for="insurance" class="cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600">Click to upload or drag and drop</p>
                            <p class="text-sm text-gray-500">PNG, JPG, PDF up to 5MB</p>
                        </label>
                        <div id="insurancePreview" class="mt-4 hidden">
                            <img src="" alt="Preview" class="max-w-xs mx-auto rounded-lg shadow-md">
                            <p class="text-sm text-gray-600 mt-2"></p>
                        </div>
                    </div>
                </div>

                <!-- Vehicle Photos -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fas fa-camera text-primary mr-3"></i>
                        Vehicle Photos
                        <span class="ml-2 text-sm text-gray-500">(Optional but recommended)</span>
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">Upload clear photos of your vehicle - front, side, interior (Maximum 5 photos)</p>
                    
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-primary transition-colors">
                        <input type="file" name="vehiclePhotos" id="vehiclePhotos" accept="image/*" multiple
                               class="hidden" onchange="handleMultipleFiles(this, 'vehiclePhotosPreview')">
                        <label for="vehiclePhotos" id="vehiclePhotosLabel" class="cursor-pointer block text-center">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600">Click to upload multiple photos</p>
                            <p class="text-sm text-gray-500">PNG, JPG up to 5MB each â€¢ Maximum 5 photos</p>
                        </label>
                        <div id="vehiclePhotosPreview" class="hidden"></div>
                    </div>
                </div>

                <!-- Important Notes -->
                <div class="mb-8 bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-triangle text-yellow-500 text-xl"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-yellow-800 mb-2">Important Guidelines:</h3>
                            <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                                <li>All documents must be valid and not expired</li>
                                <li>Photos should be clear and readable</li>
                                <li>File size should not exceed 5MB per file</li>
                                <li>Accepted formats: JPG, PNG, PDF</li>
                                <li>Verification usually takes 24-48 hours</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                    <a href="/user/dashboard" class="text-gray-600 hover:text-gray-800 font-medium">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Upload Later
                    </a>
                    <button type="submit" id="submitBtn"
                            class="bg-primary hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition duration-200 flex items-center">
                        <span id="btnText">Submit for Verification</span>
                        <i class="fas fa-check ml-2" id="btnIcon"></i>
                        <i class="fas fa-spinner fa-spin ml-2 hidden" id="btnSpinner"></i>
                    </button>
                </div>
            </form>
        </div>

        <!-- Help Section -->
        <div class="mt-8 text-center">
            <p class="text-sm text-gray-600">
                Having trouble uploading? <a href="/help" class="text-primary hover:underline font-medium">Get Help</a>
            </p>
        </div>
    </div>
</div>

<script>
    // File preview handler
    function handleFileSelect(input, previewId) {
        const preview = document.getElementById(previewId);
        const file = input.files[0];

        if (file) {
            // Validate file size (5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('File size must not exceed 5MB');
                input.value = '';
                return;
            }

            preview.classList.remove('hidden');
            
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.querySelector('img').src = e.target.result;
                    preview.querySelector('p').textContent = file.name;
                };
                reader.readAsDataURL(file);
            } else {
                preview.querySelector('img').src = '/images/pdf-icon.png';
                preview.querySelector('p').textContent = file.name;
            }
        }
    }

    // Store selected files globally
    let selectedVehiclePhotos = [];

    // Multiple files handler
    function handleMultipleFiles(input, previewId) {
        const preview = document.getElementById(previewId);
        const label = document.getElementById('vehiclePhotosLabel');
        const newFiles = Array.from(input.files);
        
        // Add new files to existing ones
        newFiles.forEach(file => {
            if (selectedVehiclePhotos.length < 5) {
                selectedVehiclePhotos.push(file);
            }
        });

        // Check if limit exceeded
        if (selectedVehiclePhotos.length > 5) {
            alert('You can only upload a maximum of 5 vehicle photos');
            selectedVehiclePhotos = selectedVehiclePhotos.slice(0, 5);
        }

        // Update the actual input with all accumulated files
        const dt = new DataTransfer();
        selectedVehiclePhotos.forEach(file => dt.items.add(file));
        input.files = dt.files;

        if (selectedVehiclePhotos.length > 0) {
            // Hide label and show preview
            label.classList.add('hidden');
            preview.classList.remove('hidden');
            preview.innerHTML = '';
            
            // Create grid container
            const gridContainer = document.createElement('div');
            gridContainer.className = 'grid grid-cols-2 md:grid-cols-3 gap-4 mb-4';

            selectedVehiclePhotos.forEach((file, index) => {
                // Validate file size
                if (file.size > 5 * 1024 * 1024) {
                    alert(`File ${file.name} exceeds 5MB`);
                    return;
                }

                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const div = document.createElement('div');
                        div.className = 'relative group';
                        div.innerHTML = `
                            <img src="${e.target.result}" alt="Vehicle Photo ${index + 1}" 
                                 class="w-full h-40 object-cover rounded-lg shadow-md border-2 border-gray-200">
                            <button type="button" onclick="removeVehiclePhoto(${index})" 
                                    class="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-200 shadow-lg">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="absolute bottom-2 left-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-xs">
                                Photo ${index + 1}
                            </div>
                        `;
                        gridContainer.appendChild(div);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            preview.appendChild(gridContainer);
            
            // Show count and add more button
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'flex items-center justify-between pt-4 border-t border-gray-200';
            actionsDiv.innerHTML = `
                <div class="text-sm text-gray-600">
                    <i class="fas fa-images mr-2 text-primary"></i>
                    <span class="font-semibold">${selectedVehiclePhotos.length}</span> of <span class="font-semibold">5</span> photos selected
                </div>
                ${selectedVehiclePhotos.length < 5 ? `
                <label for="vehiclePhotos" class="cursor-pointer text-primary hover:text-green-600 text-sm font-medium flex items-center gap-2">
                    <i class="fas fa-plus-circle"></i>
                    Add More Photos
                </label>
                ` : `
                <span class="text-sm text-gray-500 font-medium flex items-center gap-2">
                    <i class="fas fa-check-circle text-green-500"></i>
                    Maximum Reached
                </span>
                `}
            `;
            preview.appendChild(actionsDiv);
        } else {
            // No files, show label again
            label.classList.remove('hidden');
            preview.classList.add('hidden');
        }
    }

    // Remove individual vehicle photo
    function removeVehiclePhoto(indexToRemove) {
        // Remove from array
        selectedVehiclePhotos.splice(indexToRemove, 1);
        
        // Update the input
        const input = document.getElementById('vehiclePhotos');
        const dt = new DataTransfer();
        selectedVehiclePhotos.forEach(file => dt.items.add(file));
        input.files = dt.files;
        
        // Update preview
        handleMultipleFiles(input, 'vehiclePhotosPreview');
    }

    // Form submission
    const form = document.getElementById('uploadForm');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnIcon = document.getElementById('btnIcon');
    const btnSpinner = document.getElementById('btnSpinner');

    form.addEventListener('submit', function(e) {
        // Show loading state
        submitBtn.disabled = true;
        btnText.textContent = 'Uploading...';
        btnIcon.classList.add('hidden');
        btnSpinner.classList.remove('hidden');
    });

    // Drag and drop functionality
    document.querySelectorAll('.border-dashed').forEach(dropZone => {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.add('border-primary', 'bg-green-50');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.remove('border-primary', 'bg-green-50');
            }, false);
        });

        dropZone.addEventListener('drop', function(e) {
            const input = this.querySelector('input[type="file"]');
            if (input && e.dataTransfer.files.length) {
                input.files = e.dataTransfer.files;
                input.dispatchEvent(new Event('change', { bubbles: true }));
            }
        }, false);
    });
</script>

<%- include('../partials/footer') %>
